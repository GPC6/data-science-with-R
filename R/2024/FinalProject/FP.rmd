---
title: "Final Project"
author: "박찬영"
date: "2024-11-22"
output:
  rmarkdown::html_document:
    theme: lumen
---

<style>
  .answer{
    background-color: #f8f9fa;
    color: #343a40;
    font-family: 'Arial', sans-serif;
    font-size: 16px;
    line-height: 1.5;
    padding: 10px 15px;
    border-left: 4px solid #007bff;
    border-radius: 5px;
    margin: 15px auto;
    max-width: 800px;
    word-break: break-word;
  }
  </style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  warning = FALSE,
  fig.width = 6,
  fig.height = 4,
  out.width = "70%",
  fig.align = "center"
)
```

```{r library, message = FALSE}
library(tidyverse)
```

```{r dataload, eval = FALSE}
wd <- paste0(getwd(), "\\R\\2024\\FinalProject\\")
nine11 <- read_csv(paste0(wd, "911.csv"))
brfss <- read_csv(paste0(wd, "brfss2023.csv"))
modules <- read_csv(paste0(wd, "modules.csv"))
scf <- read_csv(paste0(wd, "scf_data.csv"))
scorecard <- read_csv(paste0(wd, "scorecard.csv"))
states <- read_csv(paste0(wd, "states.csv"))
```

```{r dataload2, message = FALSE}
wd <- paste0(getwd(), "\\")
nine11 <- read_csv(paste0(wd, "911.csv"))
brfss <- read_csv(paste0(wd, "brfss2023.csv"))
modules <- read_csv(paste0(wd, "modules.csv"))
scf <- read_csv(paste0(wd, "scf_data.csv"))
scorecard <- read_csv(paste0(wd, "scorecard.csv"))
states <- read_csv(paste0(wd, "states.csv"))
```


## Topic 1 : College Scorecard data
`scorecard.csv`는 미국 교육부에서 제공하는 College Scorecard 의 교육기관별 데이터이다. College Scorecard 데이터는 각 대학의 분류, 학생지원, 학생들의 성과 등에 대한 정보를 제공한다. 이 데이터셋은 6484개의 대학과 3305개의 변수로 이루어져 있다.


주요 변수와 대략적인 설명은 아래와 같다. (자세한 설명은 <a href="https://collegescorecard.ed.gov">https://collegescorecard.ed.gov</a>의 Data Dictionary에서 확인할 수 있다.)

* `UNITID` : 대학의 고유 식별번호

* `INSTNM` : 대학의 이름

* `STABBR` : state 코드 (eg. AL: Alabama, CA: California, NY: New York)

* `PREDDEG` : 대학이 수여하는 주요 학위 (`0`:미분류, `1`:자격증, `2`:준학사, `3`:학사, `4`:대학원)

* `UGDS` : 학부 학생 수

* `ADM_RATE` : 입학률(입학을 허가받은 학생 수 / 지원한 학생 수)

* `MD_EARN_WNE_P6` : 입학 후 6년 뒤 급여의 중위값

* `PCT(25/75)_EARN_WNE_P6` : 입학 후 6년 뒤 급여의 (25/75) 백분위수 (eg. `PCT25_EARN_WNE_P6`)

* `DEBT_MDN` : 상환집단(상환을 시작한 학생) 중 대출 원금의 중위값

* `RPY_5YR_RT` : 상환집단 중 채무불이행 없이 5년간 대출 상환을 유지한 비율

* `FAMINC` : 입학 시 가구소득의 평균값



#### **\* 본 분석에는 학부 학생 수가 800명 이상, 입학률이 0 초과, 수여하는 주요 학위가 학사학위인 대학만을 사용한다. 아래의 기준에 따라 데이터 전처리를 진행하고, `data_cs`로 저장하시오. [2점]**

* `UNITID`, `INSTNM`, `STABBR`은 character 변수로 저장한다.

* `PREDDEG` 변수는 factor형 변수로 저장한다.

* 이외의 주요 변수는 numeric 변수로 저장하되, 값 ’PS’는 결측(NA)으로 처리한다.

* 학부 학생 수가 800명 이상, 입학률이 0 초과, 수여하는 주요 학위가 학사학위인 대학을 추출한다.


```{r preprocessing}
data_cs <- scorecard %>%
  select(
    UNITID, INSTNM, STABBR, PREDDEG, UGDS, ADM_RATE, MD_EARN_WNE_P6,
    PCT25_EARN_WNE_P6, PCT75_EARN_WNE_P6, DEBT_MDN, RPY_5YR_RT, FAMINC
  ) %>%
  mutate(UNITID = as.character(UNITID), PREDDEG = as.factor(PREDDEG)) %>%
  mutate(across(c(10, 11, 12), ~parse_number(., na = c("PS", "NA")))) %>%
  filter(UGDS >= 800, ADM_RATE > 0, PREDDEG == 3)

glimpse(data_cs)
```

#### **Question 1. (Admission rate) [15점]**
**각 대학의 입학률(경쟁률)에 대해 살펴보고자 한다. 아래 물음에 답하시오.**



a. 입학률을 기준으로, 경쟁률이 가장 높은 상위 15개 대학을 출력하시오. [2점]

```{r 1.1.a}
data_cs %>%
  arrange(ADM_RATE) %>%
  head(15)
```

b. 대학이 가장 많이 소재한 상위 3개 주(state)를 출력하시오. [2점]

```{r 1.1.b}
data_cs %>%
  count(STABBR, sort = TRUE) %>%
  head(3)
```

c. 입학률이 0.3 이하인 대학을 ’명문(prestigious)대학’으로 정의한다. 명문대학이 가장 많이 소재한 상위 3개 주(state)를 출력하시오. [2점]

```{r 1.1.c}
data_cs %>%
  filter(ADM_RATE <= 0.3) %>%
  count(STABBR, sort = TRUE) %>%
  head(3)
```

d. 캘리포니아에 위치한 명문대학의 이름을 모두 출력하시오. [2점]

```{r 1.1.d}
data_cs %>%
  filter(ADM_RATE <= 0.3, STABBR == "CA") %>%
  select(INSTNM)
```

e. `ggplot2` 패키지의 `map_data('state')`는 미국의 각 주(state)에 대한 위도와 경도를 제공한다. 소재한 명문대학의 수가 3개 이상인 주에 대해서 명문대학의 수를 표시한 지도를 그리시오. (주어진 그래프는 일부에 대한 예시이다.) [7점]

* 주의 이름과 약어는 기본 패키지의 `state.name`과 `state.abb`을 참고한다. (Hint : Use `state_name = data.frame(region = state.name %>% tolower(), STABBR = state.abb)`)

* 주의 중심점은 위도와 경도 각각의 최대값과 최소값의 평균으로 간주한다.

* `map_data('state')`내 미국의 모든 주는 검은 선과 흰색 바탕으로 그린다. (Hint : Use `geom_polygon(aes(group=group))`)

* 해당 주를 지도 상의 색으로 표시하고 중심점에 명문대학의 수를 표기한다. (단, `label` 값을 직접 입력하는 경우 점수 미부여)

* 위도와 경도의 눈금 및 텍스트는 표시하지 않는다. (Hint : Use `theme(axis.ticks, axis.line, axis.text, axis.title)`)

* 그래프의 비율은 `coord_fixed(1.3)`을 이용한다.

<img src="\img1.png">

```{r 1.1.e}
namedoor <- data_cs %>%
  filter(ADM_RATE <= 0.3) %>%
  count(STABBR, sort = TRUE) %>%
  filter(n >= 3)

state_name <- data.frame(region = state.name %>% tolower(), STABBR = state.abb)

namedoor_map <- map_data("state") %>%
  inner_join(left_join(namedoor, state_name, by = "STABBR"), by = "region")

center <- namedoor_map %>%
  group_by(region) %>%
  summarise(
    long = mean(max(long), min(long)),
    lat = mean(max(lat), min(lat)),
    n = first(n)
  )


map_data("state") %>%
  ggplot() +
  geom_polygon(
    data = map_data("state"),
    aes(x = long, y = lat, group = group),
    fill = "white", color = "black"
  ) +
  geom_polygon(
    data = namedoor_map,
    aes(x = long, y = lat, group = group),
    fill = "#90c2fa", color = "black"
  ) +
  geom_text(data = center, aes(x = long, y = lat, label = n))
  theme(axis.ticks, axis.line, axis.text, axis.title) +
  coord_fixed(1.3)

```